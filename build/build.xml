<?xml version="1.0" encoding="UTF-8"?>
<project name="webpie" basedir="/data/www/webpie/" default="dist" description="a simple php framework">
    <property name="basedir" value="/data/www/webpie/" override="true" />
    <property name="reportsdir" value="/data/www/webpie/build/reports/" override="true" />
    <property name="coredir" value="/data/www/webpie/core/" override="true" />
    <target name="check" description="to check">
        <echo msg="运行phpcs检查代码规范" />
        <echo msg="运行pdepend检查代码的依赖关系" />
        <phpdepend>
            <fileset dir="${coredir}" />
            <logger type="jdepend-xml" outfile="${reportsdir}depend.xml" />
        </phpdepend>
        <echo msg="运行phpmd检查代码的坏味道" />
        <phpmd>
            <fileset dir="${coredir}" />
            <formatter type="xml" outfile="${reportsdir}md.xml" />
        </phpmd>
        <echo msg="运行phpcpd检查代码的复用度" />
        <phpcpd>
            <fileset dir="${coredir}" />
            <formatter type="pmd" outfile="${reportsdir}cpd.xml" />
        </phpcpd>
        <echo msg="运行phpunit单元测试" />
        <exec command="phpunit --log-junit ${reportsdir}phpunit.xml --coverage-clover ${reportsdir}phpunit.clover.xml -c test/webpieTest.xml" /> 
        <echo msg="运行phploc统计项目代码" />
        <exec command="phploc --log-xml ${reportsdir}loc.xml ${coredir}" /> 
    </target>

    <target name="dist" depends="check" description="push to github">
        <echo msg="push代码到github" />
        <exec command="git push origin master" />
    </target>
</project>
